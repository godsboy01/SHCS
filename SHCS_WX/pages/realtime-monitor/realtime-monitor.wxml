<view class="page">
  <!-- 顶部导航栏 -->
  <view class="nav-bar">
    <view class="nav-bar-content">
      <!-- 返回按钮 -->
      <view class="back-btn" bindtap="handleBack">
        <text class="back-icon">←</text>
      </view>
      <!-- 设备信息 -->
      <view class="device-info">
        <view class="device-name">监控摄像头</view>
        <view class="device-location">{{familyName}}的家</view>
      </view>
    </view>
  </view>

  <!-- 主要内容区域 -->
  <view class="container">
    <!-- 时间显示 -->
    <view class="time-display">
      <text class="time-text">{{currentTime}}</text>
    </view>

    <!-- 视频显示区域 -->
    <view class="video-container {{isPlaying ? 'playing' : ''}}">
      <block wx:if="{{isPlaying}}">
        <image src="{{videoSrc}}" 
               mode="aspectFit" 
               class="video-stream"
               bindload="handleVideoLoad"
               binderror="handleVideoError"/>
      </block>
      <view wx:else class="placeholder">
        <text>点击下方按钮开始监控</text>
      </view>
      
      <!-- 加载状态显示 -->
      <view wx:if="{{isLoading}}" class="loading-overlay">
        <view class="loading-spinner"></view>
        <text>{{errorMsg || '正在连接摄像头...'}}</text>
      </view>
      
      <!-- 错误信息显示 -->
      <view wx:if="{{!isLoading && errorMsg}}" class="error-overlay">
        <text>{{errorMsg}}</text>
        <button wx:if="{{retryCount >= maxRetries}}" 
                class="retry-btn" 
                bindtap="startVideoStream">
          重新连接
        </button>
      </view>
    </view>

    <!-- 控制按钮 -->
    <view class="controls">
      <button class="control-btn {{isPlaying ? 'playing' : ''}}" 
              bindtap="togglePlay"
              disabled="{{isLoading}}">
        {{isPlaying ? '停止监控' : '开始监控'}}
      </button>
    </view>

    <!-- 警报提示 -->
    <view wx:if="{{alertLevel > 0}}" class="alert-container">
      <view class="alert-message">
        检测到异常行为！警报级别: {{alertLevel}}
      </view>
    </view>

    <!-- 截图展示区域 -->
    <view class="snapshots-container">
      <view class="section-title">异常行为记录</view>
      
      <!-- 跌倒截图 -->
      <view class="snapshot-section">
        <view class="sub-title">跌倒记录</view>
        <scroll-view scroll-x class="snapshot-scroll">
          <block wx:for="{{fallSnapshots}}" wx:key="path">
            <image src="http://127.0.0.1:5000{{item.path}}" 
                   mode="aspectFill" 
                   class="snapshot-image"
                   binderror="handleImageError"/>
          </block>
          <view wx:if="{{!fallSnapshots.length}}" class="no-data">
            暂无记录
          </view>
        </scroll-view>
      </view>

      <!-- 坐下截图 -->
      <view class="snapshot-section">
        <view class="sub-title">坐下记录</view>
        <scroll-view scroll-x class="snapshot-scroll">
          <block wx:for="{{sitSnapshots}}" wx:key="path">
            <image src="http://127.0.0.1:5000{{item.path}}" 
                   mode="aspectFill" 
                   class="snapshot-image"
                   binderror="handleImageError"/>
          </block>
          <view wx:if="{{!sitSnapshots.length}}" class="no-data">
            暂无记录
          </view>
        </scroll-view>
      </view>
    </view>
  </view>
</view>