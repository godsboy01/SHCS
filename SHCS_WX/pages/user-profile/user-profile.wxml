<navigation-bar 
  title="个人信息" 
  background="#4CAF50" 
  color="#ffffff"
  back="{{true}}"
/>

<view class="container">
  <!-- 头像区域 -->
  <view class="avatar-section">
    <view class="avatar-wrapper" bindtap="chooseAvatar">
      <image class="avatar" src="{{userInfo.avatar || '/assets/images/default-avatar.png'}}" mode="aspectFill"></image>
      <view class="avatar-edit">点击更换头像</view>
    </view>
  </view>

  <!-- 信息列表 -->
  <block wx:if="{{userInfo}}">
    <view class="info-list">
      <view class="info-item">
        <text class="label">用户名</text>
        <text class="value">{{userInfo.username || '未设置'}}</text>
      </view>
      <view class="info-item">
        <text class="label">姓名</text>
        <text class="value">{{userInfo.name || '未设置'}}</text>
      </view>
      <view class="info-item">
        <text class="label">手机号</text>
        <text class="value">{{userInfo.phone || '未设置'}}</text>
      </view>
      <view class="info-item">
        <text class="label">邮箱</text>
        <text class="value">{{userInfo.email || '未设置'}}</text>
      </view>
      <view class="info-item">
        <text class="label">角色</text>
        <text class="value">{{userInfo.role === 'guardian' ? '监护人' : '被监护人'}}</text>
      </view>
    </view>

    <!-- 编辑按钮 -->
    <view class="button-section">
      <button class="edit-button" bindtap="navigateToEdit">编辑个人信息</button>
    </view>

    <!-- 监护关系区域 -->
    <view class="care-section" wx:if="{{userInfo.care_info && userInfo.care_info.length > 0}}">
      <view class="section-title">{{userInfo.role === 'guardian' ? '被监护人列表' : '监护人信息'}}</view>
      <view class="care-list">
        <view class="care-item" wx:for="{{userInfo.care_info}}" wx:key="index">
          <text class="name">{{item.name || '未设置姓名'}}</text>
          <text class="phone">{{item.phone || '未设置手机号'}}</text>
        </view>
      </view>
    </view>

    <!-- 家庭信息区域 -->
    <view class="family-section" hover-class="section-hover" bindtap="navigateToFamily">
      <view class="section-title">家庭信息</view>
      <view class="family-info">
        <view class="family-address-container">
          <text class="family-label">家庭地址：</text>
          <text class="family-address">{{userInfo.family_address}}</text>
        </view>
        <image class="arrow" src="/assets/images/arrow-right.png"></image>
      </view>
    </view>

    <!-- 设备列表区域 -->
    <view class="device-section" wx:if="{{devices.length > 0}}">
      <view class="section-title">关联设备</view>
      <view class="device-list">
        <view class="device-item" wx:for="{{devices}}" wx:key="device_id">
          <image class="device-icon" src="/assets/icon/{{item.device_type || 'default'}}.png" mode="aspectFit"></image>
          <view class="device-info">
            <text class="device-name">{{item.device_name || '未命名设备'}}</text>
            <text class="device-status {{item.status === 'online' ? 'online' : ''}}">
              {{item.status === 'online' ? '在线' : '离线'}}
            </text>
          </view>
        </view>
      </view>
    </view>
  </block>

  <!-- 加载中或错误提示 -->
  <block wx:else>
    <view class="loading-container">
      <text>加载中...</text>
    </view>
  </block>
</view> 